@startuml
' Set Font Size
' !$FONT_SIZE = "60"
' skinparam defaultFontSize $FONT_SIZE
' skinparam classFontSize   $FONT_SIZE
' skinparam arrowFontSize   $FONT_SIZE
' skinparam noteFontSize    $FONT_SIZE
' skinparam packageFontSize 82

' Customization Settings
skinparam dpi 100
skinparam classattributeiconsize 0
skinparam style strictuml
' !pragma ratio 2.0
' skinparam linetype ortho

' Begin UML Here

' Most activity functions are shown in storyboard so we will update this later
package "Activities" {

    class ProfileActivity
    {
        -profileController: ProfileController
    }

    class LeaderboardActivity
    {
        -learderboardController: LeaderboardController
    }

'    class OtherPlayerActivity
'    {
'        -otherPlayerController: OtherPlayerController
'    }

    class SignupActivity
    {
        -signupController: SignupController
    }

    class QrInventoryActivity
    {
        -qrInventoryController: QrInventoryController
    }

    class SearchActivity
    {
        -searchActivity: SearchController
    }

    class MapActivity
    {
        -mapController: MapController
    }

    class MainMenuActivity
    {
        -mainMenuController: MainMenuController
    }
    note top: All Activities extend Android's Activity class (not shown for readability)

    class QrScannedActivity
    {
        -QrScannedActivity: QrScannedController
    }

    class RestoreSession
    {
        -userHash: String
        -playerController: PlayerController

        +getUserQr(): String
        +loadPlayer(userHash: String)
        +sendUserToMain()
    }
}

package "Controllers" {

    class MainMenuController
    {
        -playerController: PlayerController
        -cameraController: CameraController
        -qrCodeController: QrCodeController
        ' pops up camera to scan, recive return value or exception
        ' ask qrCodeController verity & identify the qrCode
        +scanQr(): String
    }


    class ProfileController
    {
        -playerController: PlayerController

        +getPlayerName(): String
        +getPlayerContact(): String
        +generatePlayerQr(): Bitmap
    }

    class LeaderboardController
    {
        -controllerInstance: LeaderboardController
        -myScore: Integer
        -sortMethod: String
        -playerController: PlayerController

        ' PlayerController doesn't return all players at once, one player at a time.
        +getLeaderboard(list: HashMap[])
        +sortLeaderboard(list: HashMap[], sortMethod: Integer)
    }

    class SignupController
    {
        -playerController: PlayerController

        +validateUsername(playerName: String): Boolean
        +addNewPlayer(newusername: String, contact: String, password: String)
        +getUsername(): String
        ' checks the app is the first time run or load in current player in playerController
        +checkExisitingSession(): Boolean
    }

'    class OtherPlayerController
'    {
'        -inventoryArray: String[]
'        -playerController: PlayerController
'
'        +setPlayer(username: String)
'        +getPlayerInfo(infoName: String): String
'        +updateComment(comment: String, qrCodeHash: String)
'    }

    class QrCodeController
    {
        -username: String
        -locationController: LocationController
        -databaseProxy: DatabaseProxy

        ' addQrCode add a newly scanned QR code to Database and it update the geolocation index in Location Database if saved.
        +addQrCode(qrCodeHash: String, score: Integer, addLocation: Boolean)
        +updateComment(qrCodeHash: String, comment: String)
        +deleteQrCode(qrCodeHash: String)
    }

    class QrInventoryController
    {
        -playerController: PlayerController
        -qrCodeController: QrCodeController

        +getInventory(): HashMap
    }

    class SearchController
    {
        -playerController: PlayerController
        -locationController: LocationController

        +getResultByUsername(search: String): String[]
        +sendUserToProfile(selectedUser: String)
        +getResultByLocation(search: String): String[]
    }

    class MapController
    {
        -mapData: HashMap
        -locationController: LocationController
        
        +getQrCodeInfo()
        +sendDataToMap()
    }

    class LocationController
    {
        +getQrCode(location: String): QrCode[]
        +getLocation()
    }

    class PlayerController
        {
            -player: Player
            -databaseProxy: DatabaseProxy

            ' Constructor of PlayerController takes a username and pull Player from database
            +getPlayer(username: String): HashMap
            ' We will use a HashMap to send all the player's data as there would be
            ' too many parameters otherwise.
            ' Additionally, it would allow us to send NULL to specify unchanged parameters.
            +savePlayerData(count:Integer, totalScore: Integer, playerData: HashMap)
        }

    ' class CameraController
    ' {
    '     ' TODO: Add image class?
    '     -image: Image
    '     -qrHash: String

    '     +openCamera(): Image
    '     +analyzeImage(): String
    ' }

    ' class QrAnalyzer
    ' {
    '     -image: Image

    '     +setImage(image: Image)
    '     ' Return QR Hash
    '     ' Raise error if problem
    '     +analyzeImage(): String
    ' }


    class DatabaseProxy
    {
        -controllerInstance: DatabaseProxy
        -database: Database

        getInstance()
        checkValidCollection(collection: String)
        getData(callback: Function, list: HashMap[], collection: String, objectName: String )
        writeData(collection String , objectName String, data: HashMap)
        deleteData(String collection, String objectName)
    }

    class QrScannedController
    {
        -qrCodeController: QrCodeController
        -qrHash: String
        -playerController: PlayerController

        +scoreCalculator(qrHash: String): Integer
        +saveQrCode(location: Boolean)
        ' Call PlayerController to update player's inventory, total score and total count.
        ' If player chooses to not save the QR, then only update the stats.
        +byte2Hex(bytes: byte[])
        +analyzeImage(bitmap: Bitmap): String
    }
    ' note top: If player chooses to not save the QR, then only update the stats.
}

package "Models" {

    class Player
    {
        -username: String
        -qrInventory: String[]
        -contactInfo: HashMap
        -qrCount: Integer
        -totalScore: Integer

        +setUsername(name: String)
        +getUsername(): String
        +setContactInfo(field: String, info: String)
        +getContactInfo(field: String): String
        +setQrCount(count: Integer)
        +getQrCount(): Integer
        +setTotalScore(score: Integer)
        +getTotalScore(): Integer
        +setQrInventory(qrInventory: String[])
        +getQrInventory(): String[]
    }

    class QrCode
    {
        -geolocation: String
        -qrCodeHash: String
        -comment: String

        +getGeolocation(): String
        +getQrCodeHash(): String
        +getComment(): String

        +setGeolocation(geolocation: String)
        +setQrCodeHash(qrCodeHash: String)
        +setComment(comment: String)
    }

    interface Database <<interface>>
    note bottom: This is our\nFirebase instance.

    class Camera
    note bottom: This is the system camera
}


'''''''''''''''''''''''''''''''''
' Relationships Between Classes '
'''''''''''''''''''''''''''''''''

ProfileActivity "1" o-- "1" ProfileController

ProfileController "1" o-- "1" PlayerController #orange: <color:orange>Get current\n<color:orange>player 

LeaderboardActivity "1" o-- "1" LeaderboardController
LeaderboardController "1" o-- "1" PlayerController
' LeaderboardController "1" -> "1" OtherPlayerController: Get players

SignupActivity "1" o-- "1" SignupController
SignupController "1" -> "1" PlayerController #red: <color:red>Create & load\n<color:red>new player
PlayerController "1" *-- "1" Player
PlayerController "1" --> "*" DatabaseProxy: Get\nplayers

' OtherPlayerActivity "1" o-> "1" OtherPlayerController
' OtherPlayerController --> PlayerController: Gets player
' OtherPlayerActivity "1" o-> "1" OtherPlayerController: Updates\n comment
' OtherPlayerController --> QrCodeController: Adds comment

SignupActivity --> RestoreSession #red: \n\n\n<color:red>Handle\n<color:red>returning\n<color:red>player
SignupController --> "1" DatabaseProxy #green: <color:green>Check\n<color:green>username\n<color:green>uniqueness
RestoreSession  o--> PlayerController #blue: "<color:blue>Get\n<color:blue>current\n<color:blue>player"
RestoreSession --> QrScannedController: Get QR\nhash
MainMenuActivity <-- RestoreSession: \n\nSend\nuser\nto
' CameraController --> QrAnalyzer: Get hash from image
' QrAnalyzer --up> CameraController: Return hash

QrInventoryActivity "1" o-- "1" QrInventoryController
QrInventoryController "1" o-- "1" QrCodeController #green
QrCodeController "1" o-> "1" QrCode: Create &\nUpdate comment
note bottom on link: We create/update\none at a time
QrCodeController "1" --> "1" DatabaseProxy: \tGet/Save\n\tQrCode(s)
QrCodeController "1" o-- "1" LocationController: Get Location

SearchController "\t1" --> "\t1" PlayerController: Get usernames
' FIX: We shouldn't need an entire player object. Just a db call for usernames
SearchController "1" --> "\t1" LocationController: Get QR\nlocations 
SearchActivity "1" o-- "1" SearchController

LocationController "1" -> "1" DatabaseProxy: Get location data
LocationController "1" <-- " 1" MapController: Asks for location data

DatabaseProxy "1" o-- "1" Database
MainMenuController "1" o->  "1" QrScannedController #purple: <color:purple>Get QR\n<color:purple>Hash
MainMenuController "1" o--> "1" PlayerController : Get current\nplayer
MainMenuController "1" o-> "1" QrCodeController: Verify & identify\n QR Hash
MainMenuActivity "1" o-- "1" MainMenuController

QrInventoryController "1" o-- "1" PlayerController
' QrInventoryController "1" o-- "1" QrCodeController 

QrScannedController "1" --> "1" PlayerController: Get Player
QrScannedController "1" --> "1" QrCodeController: Save new\nQR Code
QrScannedActivity "1" o-- "1" QrScannedController #red

MainMenuActivity "1" --> "1" SignupActivity: Send\nnew\nuser
MainMenuActivity "1" --> "1" QrScannedActivity
MainMenuActivity "1" --> "1" QrInventoryActivity
MainMenuActivity "1" --> "1" MapActivity
MainMenuActivity "1" --> "1" ProfileActivity
' MainMenuActivity "1" --> "1" OtherPlayerActivity
MainMenuActivity "1" --> "1" LeaderboardActivity
MainMenuActivity "1" --> "1" SearchActivity

QrScannedController "1" --> "1" Camera: Get photo
MapActivity "1" o-- "1" MapController

' TODO: Open QrInventory
' SearchActivity "1" -> "1" OtherPlayerActivity: Opens profile

' Layout Connections
PlayerController -[hidden]- QrScannedController
DatabaseProxy -[hidden]l- QrScannedController
' DatabaseProxy -[hidden]- QrAnalyzer
MapController -[hidden]- Player
PlayerController -[hidden]- QrCodeController
SignupActivity -[hidden]- SearchActivity
SignupActivity -[hidden]- ProfileActivity
SignupActivity -[hidden]- QrInventoryActivity
RestoreSession -[hidden]- SearchActivity
RestoreSession -[hidden]- LeaderboardActivity
QrScannedActivity -[hidden]- SearchActivity
Player -[hidden]- QrCode
@enduml

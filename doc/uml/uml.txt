@startuml

' Customization Settings
skinparam dpi 300
skinparam classattributeiconsize 0

' Begin UML Here

' Most activity functions are shown in storyboard so we will update this later
package "Activities" {

    class ProfileActivity

    class LeaderboardActivity

    class OtherPlayerActivity

    class SignupActivity
    {
        +usernameInvalid()
    }

    class QrInventoryActivity
    {
        -qrDataList: QrCode[]
    }

    class SearchActivity

    class MapActivity

    class MainMenuActivity
}

package "Controllers" {

    class ProfileController
    {
        -player: Player
        -activity: Activity

        +getPlayerName(): String
        +getPlayerContact(): String
        +generatePlayerQr(): Image
    }

    class LeaderboardController
    {
        -myScore: Integer
        -sortBy: String
        -currentRanking: Player[]

        +getSortBy(): String
        ' FIX: sortData() weird :/
        +sortData(): Player[]
    }

    class SignupController
    {
        -newPlayer: Player
        -playerName: String

        +addNewPlayer(newPlayer: Player)
        +validateUsername(playerName: String): Boolean
        +getUsername(): String
        +firstRunCheck(): Boolean
        +sendUserToMain(newPlayer: Player)
        +sendToRestore()
    }

    class PlayerController
    {
        -player: Player

        +getPlayer(username: String): Player
        ' We will use a HashMap to send all the player's data as there would be
        ' too many parameters otherwise.
        ' Additionally, it would allow us to send NULL to specify unchanged parameters.
        +savePlayerData(playerData: HashMap)
    }

    class OtherPlayerController
    {
        -player: Player

        +setPlayer(username: String)
        +getPlayerInfo(infoName: String): String
        +updateComment(comment: String)
    }

    class QrCodeController
    {
        -username: String
        -qrCodeHash: String

        +addComment(username: String, qrCodeHash: String, comment: String)
        +deleteQr(username: String, qrCodeHash: String)
    }

    class QrInventoryController
    {
        -username: String

        ' FIX: Functionality not in CRC (who are we sending a hash to?)
        +sendHash(qrCodeHash: String)
    }

    class SearchController
    {
        -searchText: String
        -selectedUser: Player

        +getResultByUsername(): String[]
        +sendUserToProfile(selectedUser: Player)
        +getResultByLocation(): String[]

    }

    class LocationController
    {
        +getLocation(): Location
    }

    class MapController
    {
        -mapData: HashMap

        +getQrCodeInfo()
        +sendDataToMap()
    }

    class CameraController
    {
        ' TODO: Add image class?
        -image: Image
        -qrHash: String

        +openCamera(): Image
        +analyzeImage(): String
    }

    class DatabaseController
    {
        ' Database instance
        -database: Database

        readFromDatabase(collection: String): HashMap
        writeToDatabase(collection: String, data: HashMap)
    }

    class RestoreSession
    {
        -userHash: String
        -player: Player

        +getUserQr(): String
        +loadPlayer(hash: String)
        +sendUserToMain()
    }
}

package "Models" {

    class Player
    {
        -username: String
        -qrInventory: String[]
        -contactInfo: HashMap
        -qrCount: Integer
        -totalScore: Integer

        +setUsername(name: String)
        +getUsername(): String
        +setContactInfo(field: String, info: String)
        +getContactInfo(field: String): String
        +setQrCount(count: Integer)
        +getQrCount(): Integer
        +setTotalScore(score: Integer)
        +getTotalScore(): Integer
        +setQrInventory(qrInventory: String[])
        +getQrInventory(): String[]
    }


    class QrCode
    {
        -geolocation: String[]
        -qrCodeHash: String
        -comment: String

        +getGeolocation(): String[]
        +getQrCodeHash(): String
        +getComment(): String
        ' FIX: Make geolocation single String?
'       +setGeolocation(geolocation: String[])
        +setQrCodeHash(qrCodeHash: String)
        +setComment(comment: String)
    }

    class QrAnalyzer
    {
        -image: Image

        +setImage(image: Image)
        ' Return QR Hash
        ' Raise error if problem
        +analyzeImage(): String
    }

    class Location
    {
        ' NOTE: Use location city name + place or hash it somehow?
        -qrCodes: String[]

        '' Store QR codes at this location
        ' +addQrCode(qrHash: String)
        ' +delQrCode(qrHash: String)
    }

    ' NOTE: May want to remove since Firebase implements
    class Database
    {
        -data: HashMap

        getData(collection: String): HashMap
        writeData(collection: String, data: HashMap)
    }

    note bottom: This is our\nFirebase instance.
}

ProfileController "1" *-up- "1" ProfileActivity
ProfileController "1" *-- "1" Player

ProfileController --> Player: Get player username\nand contact
ProfileController -up-> ProfileActivity: Send username and contact
ProfileController -up-> ProfileActivity: Send user's QR image

LeaderboardActivity "1" --* "1" LeaderboardController

SignupActivity "1" --* "1" SignupController
SignupController "1" *-- "1" Player
SignupController "1" --* "1" PlayerController
PlayerController "1" *-- "*" Player

OtherPlayerActivity "1" --* "1" OtherPlayerController
Player "1" --* "1" OtherPlayerController
OtherPlayerController --> PlayerController: Gets player
OtherPlayerController --> OtherPlayerActivity: Updates comment

SignupController --> RestoreSession: "Ask to handle\nreturning player"
RestoreSession <-- CameraController: "Return QR hash"
RestoreSession --> PlayerController: "Get player"
RestoreSession --> CameraController: "Ask to\n open camera"
RestoreSession -up-> MainMenuActivity: "Send user to"
CameraController -down-> QrAnalyzer: "Send image to analyze"
CameraController <-up- QrAnalyzer: "Return hash"

QrInventoryController "1" *-- "1" QrInventoryActivity
QrCode "1" *-- "1" Location
QrInventoryController --> QrCodeController
QrCodeController "1" *-down- "*" QrCode
QrCodeController --> DatabaseController

SearchController --> DatabaseController
' FIX: We shouldn't need an entire player object. Just a db call for usernames
SearchController --> Player
SearchController --> LocationController

LocationController --> DatabaseController: Get location data
MapController --> LocationController: Asks for location data

DatabaseController "1" *-- "1" Database

@enduml
